---
phase: 11-ui-ux-overhaul
plan: 07
type: execute
wave: 5
depends_on: ["11-06"]
files_modified:
  - app/components/workspace/report-workspace.tsx
  - app/components/workspace/workspace-tabs.tsx
  - app/app/(protected)/dashboard/page.tsx
autonomous: false

must_haves:
  truths:
    - "Report workspace has tabbed interface: Context, Transcribe, Report"
    - "Tab content animates smoothly on switch"
    - "Existing generate/transcribe functionality works in new layout"
    - "PDF export accessible from workspace actions bar"
  artifacts:
    - path: "app/components/workspace/report-workspace.tsx"
      provides: "Main report workspace with tabs and actions"
      exports: ["ReportWorkspace"]
    - path: "app/components/workspace/workspace-tabs.tsx"
      provides: "Tab navigation for workspace modes"
      exports: ["WorkspaceTabs"]
  key_links:
    - from: "app/components/workspace/report-workspace.tsx"
      to: "app/components/workspace/workspace-tabs.tsx"
      via: "uses WorkspaceTabs for navigation"
      pattern: "import.*WorkspaceTabs"
---

<objective>
Create the report workspace component with tabbed interface for the main content area.

Purpose: Consolidate the report generation workflow (context input, voice transcription, AI generation) into a single unified workspace. This reduces page navigation and keeps all related actions visible.

Output: ReportWorkspace component with Context/Transcribe/Report tabs, action bar (Generate, Export PDF), and integration with existing functionality.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-ui-ux-overhaul/11-RESEARCH.md (see "Layout Architecture" section)
@app/app/(protected)/dashboard/page.tsx (existing dashboard with generate functionality)
</context>

<tasks>
<task id="1" type="code" commit="feat(11-07): create WorkspaceTabs component">
Create the tab navigation component for the workspace.

**Create `app/components/workspace/workspace-tabs.tsx`:**

```typescript
'use client';

import { motion } from 'framer-motion';
import { FileText, Mic, ScrollText } from 'lucide-react';
import { cn } from '@/lib/utils';

export type WorkspaceTab = 'context' | 'transcribe' | 'report';

interface WorkspaceTabsProps {
  activeTab: WorkspaceTab;
  onTabChange: (tab: WorkspaceTab) => void;
  hasReport?: boolean;
}

const tabs = [
  { id: 'context' as const, label: 'Context', icon: FileText },
  { id: 'transcribe' as const, label: 'Transcribe', icon: Mic },
  { id: 'report' as const, label: 'Report', icon: ScrollText },
];

export function WorkspaceTabs({ activeTab, onTabChange, hasReport }: WorkspaceTabsProps) {
  return (
    <div className="flex border-b border-border">
      {tabs.map((tab) => {
        const isActive = activeTab === tab.id;
        const Icon = tab.icon;

        return (
          <button
            key={tab.id}
            onClick={() => onTabChange(tab.id)}
            className={cn(
              "relative flex items-center gap-2 px-4 py-3 text-sm font-medium",
              "transition-colors hover:text-foreground",
              isActive ? "text-foreground" : "text-muted-foreground"
            )}
          >
            <Icon className="h-4 w-4" />
            {tab.label}
            {tab.id === 'report' && hasReport && (
              <span className="h-2 w-2 rounded-full bg-green-500" />
            )}
            {isActive && (
              <motion.div
                layoutId="activeTab"
                className="absolute bottom-0 left-0 right-0 h-0.5 bg-brand"
                transition={{ duration: 0.2 }}
              />
            )}
          </button>
        );
      })}
    </div>
  );
}
```

**Verification:**
```bash
grep -l "export.*WorkspaceTabs" app/components/workspace/workspace-tabs.tsx
```
</task>

<task id="2" type="code" commit="feat(11-07): create ReportWorkspace component">
Create the main workspace component that contains tab content and actions.

**Create `app/components/workspace/report-workspace.tsx`:**

```typescript
'use client';

import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useReducedMotion } from 'framer-motion';
import { Download, Sparkles, RotateCcw } from 'lucide-react';
import { WorkspaceTabs, WorkspaceTab } from './workspace-tabs';
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
import { FadeIn } from '@/components/motion';

interface ReportWorkspaceProps {
  // Props for template selection, report state, etc.
  selectedTemplateId?: string;
  onTemplateSelect?: (id: string) => void;
}

export function ReportWorkspace({ selectedTemplateId, onTemplateSelect }: ReportWorkspaceProps) {
  const [activeTab, setActiveTab] = useState<WorkspaceTab>('context');
  const [contextText, setContextText] = useState('');
  const [reportContent, setReportContent] = useState<string | null>(null);
  const [isGenerating, setIsGenerating] = useState(false);
  const shouldReduceMotion = useReducedMotion();

  const handleGenerate = async () => {
    setIsGenerating(true);
    // TODO: Integrate with existing generate API
    // For now, simulate generation
    setTimeout(() => {
      setReportContent('Generated report content will appear here...');
      setIsGenerating(false);
      setActiveTab('report');
    }, 1500);
  };

  const handleExportPDF = () => {
    // TODO: Integrate with existing PDF export
    window.print();
  };

  return (
    <div className="flex flex-col h-full">
      {/* Header with template selector */}
      <div className="flex items-center justify-between p-4 border-b border-border">
        <div className="flex items-center gap-4">
          <h1 className="text-lg font-semibold">New Report</h1>
          {/* Template selector dropdown - integrate with existing */}
          <select
            className="text-sm border border-border rounded-md px-2 py-1 bg-background"
            value={selectedTemplateId || ''}
            onChange={(e) => onTemplateSelect?.(e.target.value)}
          >
            <option value="">Select template...</option>
            <option value="ct-chest">CT Chest</option>
            <option value="mri-brain">MRI Brain</option>
            <option value="xray-chest">X-Ray Chest</option>
          </select>
        </div>

        {/* Actions */}
        <div className="flex items-center gap-2">
          <Button
            variant="outline"
            size="sm"
            onClick={() => {
              setContextText('');
              setReportContent(null);
              setActiveTab('context');
            }}
          >
            <RotateCcw className="h-4 w-4 mr-1" />
            Clear
          </Button>
          <Button
            variant="outline"
            size="sm"
            onClick={handleExportPDF}
            disabled={!reportContent}
          >
            <Download className="h-4 w-4 mr-1" />
            Export PDF
          </Button>
          <Button
            size="sm"
            onClick={handleGenerate}
            disabled={!contextText || isGenerating}
          >
            <Sparkles className="h-4 w-4 mr-1" />
            {isGenerating ? 'Generating...' : 'Generate Report'}
          </Button>
        </div>
      </div>

      {/* Tabs */}
      <WorkspaceTabs
        activeTab={activeTab}
        onTabChange={setActiveTab}
        hasReport={!!reportContent}
      />

      {/* Tab Content */}
      <div className="flex-1 overflow-auto p-4">
        <AnimatePresence mode="wait">
          <motion.div
            key={activeTab}
            initial={shouldReduceMotion ? false : { opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -10 }}
            transition={{ duration: 0.15 }}
            className="h-full"
          >
            {activeTab === 'context' && (
              <ContextTab
                value={contextText}
                onChange={setContextText}
              />
            )}
            {activeTab === 'transcribe' && (
              <TranscribeTab
                onTranscriptionComplete={(text) => {
                  setContextText(prev => prev + '\n' + text);
                  setActiveTab('context');
                }}
              />
            )}
            {activeTab === 'report' && (
              <ReportTab content={reportContent} />
            )}
          </motion.div>
        </AnimatePresence>
      </div>
    </div>
  );
}

// Tab content components
function ContextTab({ value, onChange }: { value: string; onChange: (v: string) => void }) {
  return (
    <Card className="h-full p-4">
      <label className="block text-sm font-medium mb-2">Clinical Context & Findings</label>
      <textarea
        value={value}
        onChange={(e) => onChange(e.target.value)}
        placeholder="Enter clinical history, indication, and findings..."
        className="w-full h-[calc(100%-2rem)] resize-none border border-border rounded-md p-3 bg-background focus:ring-2 focus:ring-brand focus:border-transparent"
      />
    </Card>
  );
}

function TranscribeTab({ onTranscriptionComplete }: { onTranscriptionComplete: (text: string) => void }) {
  // TODO: Integrate with existing transcription component
  return (
    <Card className="h-full p-4 flex flex-col items-center justify-center">
      <div className="text-center">
        <div className="w-16 h-16 rounded-full bg-brand/10 flex items-center justify-center mx-auto mb-4">
          <span className="text-3xl">ðŸŽ¤</span>
        </div>
        <h3 className="text-lg font-medium mb-2">Voice Transcription</h3>
        <p className="text-muted-foreground mb-4">
          Click the button below to start recording your findings
        </p>
        <Button onClick={() => onTranscriptionComplete('Sample transcribed text')}>
          Start Recording
        </Button>
      </div>
    </Card>
  );
}

function ReportTab({ content }: { content: string | null }) {
  if (!content) {
    return (
      <Card className="h-full p-4 flex items-center justify-center">
        <div className="text-center text-muted-foreground">
          <ScrollText className="h-12 w-12 mx-auto mb-4 opacity-50" />
          <p>No report generated yet.</p>
          <p className="text-sm">Enter context and click "Generate Report"</p>
        </div>
      </Card>
    );
  }

  return (
    <Card className="h-full p-4 prose dark:prose-invert max-w-none">
      <div dangerouslySetInnerHTML={{ __html: content }} />
    </Card>
  );
}
```

**Verification:**
```bash
grep -l "export.*ReportWorkspace" app/components/workspace/report-workspace.tsx
```
</task>

<task id="3" type="code" commit="feat(11-07): integrate ReportWorkspace into dashboard">
Update the dashboard to use the new ReportWorkspace as the primary interface.

**Modify `app/app/(protected)/dashboard/page.tsx`:**

Import and render ReportWorkspace as the main content:

```typescript
import { ReportWorkspace } from '@/components/workspace/report-workspace';
import { PageWrapper } from '@/components/motion';

export default function DashboardPage() {
  return (
    <PageWrapper className="h-full">
      <ReportWorkspace />
    </PageWrapper>
  );
}
```

The existing quick actions, YOLO mode toggle, and other dashboard elements should be preserved but may be moved to the sidebar or a secondary location.

**Verification:**
```bash
grep -l "ReportWorkspace" app/app/\(protected\)/dashboard/page.tsx
```
</task>

<task id="4" type="checkpoint:human-verify">
Verify report workspace functionality.

**How to verify:**

1. Run: `cd /Users/anand/rad-ai-auto/app && npm run dev`
2. Login and go to dashboard
3. Verify workspace layout:
   - Header with "New Report" title and template selector
   - Action buttons: Clear, Export PDF, Generate Report
   - Tab navigation: Context, Transcribe, Report
4. Test Context tab:
   - Type text in the textarea
   - Text should be preserved when switching tabs
5. Test tab switching:
   - Smooth animation between tabs
   - Report tab shows placeholder when empty
6. Test Generate button:
   - Click Generate Report
   - Button should show "Generating..." state
   - Should switch to Report tab when done
7. Test Export PDF:
   - Should be disabled when no report
   - Should open print dialog when report exists

**Expected behavior:**
- Unified workspace feel (no page navigation needed)
- Smooth tab transitions
- State preserved across tab switches
- Actions clearly visible in header
</task>
</tasks>

<success_criteria>
- [ ] WorkspaceTabs renders with animated indicator
- [ ] ReportWorkspace integrates all tab content
- [ ] Dashboard uses ReportWorkspace as main content
- [ ] Tab switching animates smoothly
- [ ] Generate and Export actions work
- [ ] Human verification passed
</success_criteria>
