---
phase: 20-vercel-deployment-readiness
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/vercel.json
  - app/.env.example
autonomous: true
must_haves:
  truths:
    - "vercel.json configures project for optimal deployment"
    - "Environment variables documented for all deployment stages"
    - "Build and install commands explicitly specified"
  artifacts:
    - path: "app/vercel.json"
      provides: "Vercel deployment configuration"
      min_lines: 15
    - path: "app/.env.example"
      provides: "Complete environment variable documentation"
      contains: "NEXT_PUBLIC_APP_URL"
  key_links:
    - from: "vercel.json"
      to: "Vercel platform"
      via: "deployment configuration"
      pattern: "buildCommand|installCommand"
---

<objective>
Create Vercel deployment configuration and document all environment variables for dev/preview/production stages.

Purpose: Enable seamless Vercel deployment with proper configuration.
Output: vercel.json and updated .env.example with complete variable documentation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/STACK.md

Relevant source files:
@app/.env.example
@app/package.json
@app/next.config.mjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create vercel.json configuration</name>
  <files>app/vercel.json</files>
  <action>
Create `app/vercel.json` with:
```json
{
  "$schema": "https://openapi.vercel.sh/vercel.json",
  "buildCommand": "pnpm build",
  "installCommand": "pnpm install",
  "framework": "nextjs",
  "regions": ["iad1"],
  "functions": {
    "app/api/generate/route.ts": {
      "maxDuration": 60
    },
    "app/api/transcribe/route.ts": {
      "maxDuration": 120
    },
    "app/api/templates/suggest/route.ts": {
      "maxDuration": 60
    },
    "app/api/templates/generate/route.ts": {
      "maxDuration": 60
    },
    "app/api/stripe/webhook/route.ts": {
      "maxDuration": 30
    }
  }
}
```

Configuration rationale:
- `regions: ["iad1"]` - US East (Virginia), good global latency, matches typical Supabase region
- AI routes get 60s timeout (GPT-4o can be slow)
- Transcribe gets 120s (audio files can be large)
- Webhook gets 30s (standard webhook processing)
  </action>
  <verify>cat app/vercel.json && node -e "JSON.parse(require('fs').readFileSync('app/vercel.json'))"</verify>
  <done>vercel.json created with valid JSON and proper function timeouts</done>
</task>

<task type="auto">
  <name>Task 2: Document environment variables comprehensively</name>
  <files>app/.env.example</files>
  <action>
Update `app/.env.example` with clear documentation and environment-specific guidance:

```bash
# ============================================
# AI Radiologist - Environment Configuration
# ============================================
# Copy this file to .env.local for development
#
# Environment variable scoping for Vercel:
#   - Development: Local .env.local file
#   - Preview: Vercel Dashboard → Settings → Environment Variables (Preview)
#   - Production: Vercel Dashboard → Settings → Environment Variables (Production)
#
# Variables prefixed with NEXT_PUBLIC_ are exposed to the browser.
# All other variables are server-only.
# ============================================

# -----------------------
# Supabase Configuration
# -----------------------
# Get from: https://supabase.com/dashboard/project/_/settings/api

# Public URL (exposed to browser)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co

# Anonymous key (exposed to browser - safe for client-side auth)
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...

# Service role key (server-only - NEVER expose to client)
# Used for admin operations bypassing RLS
SUPABASE_SERVICE_ROLE_KEY=eyJ...

# Connection pooler URL for Prisma/direct DB access (optional)
# SUPABASE_POOLER_URL=postgres://user:pass@your-project.supabase.co:6543/postgres

# -----------------------
# OpenAI Configuration
# -----------------------
# Get from: https://platform.openai.com/api-keys

OPENAI_API_KEY=sk-proj-...

# Model configuration (defaults in code if not set)
# OPENAI_MODEL_GENERATE=gpt-4o
# OPENAI_MODEL_WHISPER=whisper-1

# -----------------------
# Stripe Configuration
# -----------------------
# Get from: https://dashboard.stripe.com/apikeys
#
# IMPORTANT: Use test keys for development/preview, live keys for production only

# Secret key (server-only)
# Test: sk_test_...  |  Live: sk_live_...
STRIPE_SECRET_KEY=sk_test_...

# Publishable key (exposed to browser)
# Test: pk_test_...  |  Live: pk_live_...
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...

# Webhook signing secret
# Get from: Stripe Dashboard → Developers → Webhooks → Signing secret
# Local dev: Use `stripe listen` CLI to get whsec_...
STRIPE_WEBHOOK_SECRET=whsec_...

# Price IDs for subscription plans
# Get from: Stripe Dashboard → Products → [Product] → Pricing → API ID
STRIPE_PRICE_ID_PLUS=price_...
STRIPE_PRICE_ID_PRO=price_...

# -----------------------
# Application Settings
# -----------------------

# Environment (development, preview, production)
NODE_ENV=development

# Public app URL (used for OAuth callbacks, email links)
# Development: http://localhost:3000
# Preview: Automatically set by Vercel (VERCEL_URL)
# Production: Your custom domain
NEXT_PUBLIC_APP_URL=http://localhost:3000

# -----------------------
# Optional: Redis/Upstash (Rate Limiting)
# -----------------------
# Get from: https://console.upstash.com/
# Not required for initial deployment - can add later

# UPSTASH_REDIS_REST_URL=https://your-instance.upstash.io
# UPSTASH_REDIS_REST_TOKEN=your_token

# -----------------------
# Optional: Storage (Audio Transcription)
# -----------------------
# Only needed if using file-based transcription

# TRANSCRIBE_STORAGE_BUCKET=audio-temp
# TRANSCRIBE_ENCRYPTION_KEY=32-character-encryption-key-here
```
  </action>
  <verify>cat app/.env.example | head -80</verify>
  <done>.env.example updated with comprehensive documentation and environment guidance</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `app/vercel.json` exists and contains valid JSON
- [ ] Function timeouts configured for AI routes
- [ ] `.env.example` documents all required variables
- [ ] Environment scoping (dev/preview/prod) explained
- [ ] Security notes included (which vars are public vs server-only)
</verification>

<success_criteria>

- All tasks completed
- vercel.json validates as JSON
- .env.example is comprehensive and developer-friendly
- Clear guidance for Vercel environment variable setup
  </success_criteria>

<output>
After completion, create `.planning/phases/20-vercel-deployment-readiness/20-02-SUMMARY.md`
</output>
