---
phase: 07-pdf-export
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/app/(protected)/generate/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can export generated report as PDF via print dialog"
    - "PDF contains complete report with all sections"
    - "PDF has professional medical document formatting"
    - "PDF includes metadata (template, modality, body part, date)"
    - "PDF includes standard disclaimer"
  artifacts:
    - path: "app/app/(protected)/generate/page.tsx"
      provides: "Enhanced PDF export with professional formatting"
      contains: "handleExportPDF"
  key_links:
    - from: "Export PDF button"
      to: "print window"
      via: "handleExportPDF"
      pattern: "window.open.*print"
---

<objective>
Enhance PDF export to produce professional medical-quality documents.

Purpose: Transform the basic print-based PDF export into a properly formatted medical report document suitable for clinical records and professional use.

Output: Enhanced handleExportPDF function with professional styling and medical document layout.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-ai-report-generation/04-01-SUMMARY.md

@app/app/(protected)/generate/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance PDF export with professional medical document styling</name>
  <files>app/app/(protected)/generate/page.tsx</files>
  <action>
    Update the `handleExportPDF` function (currently lines 645-726) to produce professional medical document formatting:

    **Header Section Enhancements:**
    - Add report metadata: Template name, Modality, Body Part
    - Include generation timestamp in standard format
    - Professional title styling with proper hierarchy

    **Body Section Enhancements:**
    - Parse report sections using existing `parseReportSections()` function
    - Style each section with clear visual separation
    - Use appropriate medical document typography (serif fonts)
    - Add section headers with consistent formatting (bold, larger font)
    - Proper line spacing for readability (1.5-2x line height)

    **Footer Section Enhancements:**
    - Standard disclaimer: "This report was generated using AI Radiologist software. Please review all findings with a qualified radiologist."
    - "AI-Generated Report" watermark or indicator
    - Page margins suitable for printing (1 inch margins)

    **Print Optimization:**
    - @media print rules for proper page breaks
    - Avoid orphaned section headers
    - Black and white optimized styling

    **DO NOT:**
    - Add external PDF library dependencies (keep browser print approach)
    - Change the Word export functionality
    - Modify other parts of the generate page
  </action>
  <verify>
    Build passes: `cd /Users/anand/rad-ai-auto/app && npm run build`
  </verify>
  <done>
    PDF export button produces professional HTML with medical document styling, ready for browser print-to-PDF
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Enhanced PDF export with professional medical document formatting</what-built>
  <how-to-verify>
    1. Run: `cd /Users/anand/rad-ai-auto/app && npm run dev`
    2. Visit: http://localhost:3000/generate
    3. Select a template and enter sample findings: "No acute findings. Heart size normal."
    4. Click "Generate Report" (requires OPENAI_API_KEY or will show error)
    5. If no API key: Copy this sample report text manually into the report display area (or test with mock):
       ```
       RADIOLOGY REPORT
       Template: Chest X-Ray
       Modality: X-Ray
       Body Part: Chest

       CLINICAL INDICATION:
       No acute findings. Heart size normal.

       FINDINGS:
       Heart size is within normal limits. The lungs are clear without focal consolidation.

       IMPRESSION:
       Normal chest radiograph.

       ---
       Generated by AI Radiologist
       ```
    6. Click "Export PDF" button
    7. Verify in print preview:
       - Professional header with title, metadata (template, modality, body part, date)
       - Clear section separation with styled headers
       - Readable typography (serif font, good line spacing)
       - Footer with disclaimer and AI-generated indicator
       - Clean black-and-white print appearance
       - Proper margins (approximately 1 inch)
  </how-to-verify>
  <resume-signal>Type "approved" if PDF looks professional and suitable for medical records, or describe formatting issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Export PDF button works and opens print dialog
- [ ] PDF preview shows professional medical document formatting
- [ ] All report sections properly displayed with styling
- [ ] Header and footer contain appropriate metadata and disclaimers
</verification>

<success_criteria>

- PDF export produces professional medical document appearance
- All report sections rendered with clear visual hierarchy
- Metadata (template, modality, body part, date) visible in header
- Disclaimer and AI indicator in footer
- Print-optimized styling works in browser print preview
- Human verification passed
</success_criteria>

<output>
After completion, create `.planning/phases/07-pdf-export/07-01-SUMMARY.md`
</output>
